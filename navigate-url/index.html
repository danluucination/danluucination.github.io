<!doctypehtml><html lang=en><meta charset=utf-8><title>What happens when you load a URL?</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="stylesheet" href="/styles.css"></style><link rel=icon href="data:;base64,="> <header><strong>What happens when you load a URL?</strong> | <i><b><a href=https://patreon.com/danluu>I'm trying some experimental tiers on Patreon</a></b> to see if I can get to <a href=https://twitter.com/danluu/status/1456346963691991041>substack-like levels of financial support for this blog without moving to substack</a>!</i><hr></header><main> <p>I've been hearing this question a lot lately, and when I do, it reminds me how much I don't know. Here are some questions this question brings to mind.</p>  <ol> <li>How does a keyboard work? Why can’t you press an arbitrary combination of three keys at once, except on fancy gaming keyboards? That implies something about how key presses are detected/encoded.</li> <li>How are keys debounced? Is there some analog logic, or is there a microcontroller in the keyboard that does this, or what? How do membrane switches work?</li> <li>How is the OS notified of the keypress? I could probably answer this for a 286, but nowadays it's somehow done through x2APIC, right? How does that work?</li> <li>Also, USB, PS/2, and AT keyboards are different, somehow? How does USB work? And what about laptop keyboards? Is that just a USB connection?</li> <li>How does a USB connector work? You have this connection that can handle 10Gb/s. That surely won't work if there's any gap at all between the physical doodads that are being connected. How do people design connectors that can withstand tens of thousands of insertions and still maintain their tolerances?</li> <li>How does the OS tell the program something happened? How does it know which program to talk to?</li> <li>How does the browser know to try to load a webpage? I guess it sees an &quot;http://&quot; or just assumes that anything with no prefix is a URL?</li> <li>Assume we don't have the webpage cached, so we have to do DNS queries and stuff.</li> <li>How does DNS work? How does DNS caching work? Let's assume it isn't cached at anywhere nearby and we have to go find some far away DNS server.</li> <li>TCP? We establish a connection? Do we do that for DNS or does it have to be UDP?</li> <li>How does the OS decide if an outgoing connection should be allowed? What if there's a software firewall? How does that work?</li> <li>For TCP, without TLS/SSL, we can just do slow-start followed by some standard congestion protocol, right? Is there some deeper complexity there?</li> <li>One level down, how does a network card work?</li> <li>For what matter, how does the network card know what to do? Is there a memory region we write to that the network card can see or does it just monitor bus transactions directly?</li> <li>Ok, say there's a memory region. How does that work? How do we write memory?</li> <li>Some things happen in the CPU/SoC! This is one of the few areas where I know something, so, I'll skip over that. A signal eventually comes out on some pins. What's that signal? Nowadays, people use DDR3, but we didn't always use that protocol. Presumably DDR3 lets us go faster than DDR2, which was faster than DDR, and so on, but why?</li> <li>And then the signal eventually goes into a DRAM module. As with the CPU, I'm going to mostly ignore what's going on inside, but I'm curious if DRAM modules still either trench capacitors or stacked capacitors, or has this technology moved on?</li> <li>Going back to our network card, what happens when the signal goes out on the wire? Why do you need a cat5 and not a cat3 cable for 100Mb Ethernet? Is that purely a signal integrity thing or do the cables actually have different wiring?</li> <li>One level below that the wires are surely long enough that they can act like transmission lines / waveguides. How is termination handled? Is twisted pair sufficient to prevent inductive coupling or is there more fancy stuff going on?</li> <li>Say we have a local Ethernet connection to a cable modem. How do cable modems work? Isn't cable somehow multiplexed between different customers? How is it possible to get so much bandwidth through a single coax cable?</li> <li>Going back up a level, the cable connection eventually gets to the ISP. How does the ISP know where to route things? How does internet routing work? Some bits in the header decide the route? How do routing tables get adjusted?</li> <li>Also, the 8.8.8.8 DNS stuff is anycast, right? How is that different from routing &quot;normal&quot; traffic? Ditto for anything served from a Cloudflare CDN. What do they need to do to prevent route flapping and other badness?</li> <li>What makes anycast hard enough to do that very few companies use it?</li> <li>IIRC, the Stanford/Coursera algorithms course mentioned that it's basically a distributed Bellman-Ford calculation. But what prevents someone from putting bogus routes up?</li> <li>If we can figure out where to go our packets go from our ISP through some edge router, some core routers, another edge router, and then go through their network to get into the “meat” of a datacenter.</li> <li>What's the difference between core and edge routers?</li> <li>At some point, our connection ends up going into fiber. How does that happen?</li> <li>There must be some kind of laser. What kind? How is the signal modulated? Is it WDM or TDM? Is it single-mode or multi-mode fiber?</li> <li>If it's WDM, how is it muxed/demuxed? It would be pretty weird to have a prism in free space, right? This is the kind of thing an AWG could do. Is that what's actually used?</li> <li>There must be repeaters between links. How do repeaters work? Do they just boost the signal or do they decode it first to avoid propagating noise? If the latter, there must be DCF between repeaters.</li> <li>Something that just boosts the signal is the simplest case. How does an EDFA work? Is it basically just running current through doped fiber, or is there something deeper going on there?</li> <li>Below that level, there's the question of how standard single mode fiber and DCF work.</li> <li>Why do we need DCF, anyway? I guess it's cheaper to have a combination of standard fiber and DCF than to have fiber with very low dispersion. Why is that?</li> <li>How does fiber even work? I mean, ok, it's probably a waveguide that uses different dielectrics to keep the light contained, but what's the difference between good fiber and bad fiber?</li> <li>For example, hasn't fiber changed over the past couple decades to severely reduce PMD? How is that possible? Is that just more precise manufacturing, or is there something else involved?</li> <li>Before PMD became a problem and was solved, there was decades of work that went into increasing fiber bandwidth, vaugely analogous to the way there was decades of work that went into increasing processor performance but also completely different. What was that work and what were the blockers that work was clearing? You'd have to actually know a good deal about fiber engineering to answer this, and I don't.</li> <li>Going back up a few levels, we go into a datacenter. What's up there? Our packets go through a switching network to TOR to machine? What's a likely switch topology? <a href=https://code.facebook.com/posts/360346274145943/introducing-data-center-fabric-the-next-generation-facebook-data-center-network/ >Facebook's</a> isn't quite something straight out of <a href="http://www.amazon.com/gp/product/0122007514/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=1789&amp;creative=9325&amp;creativeASIN=0122007514&amp;linkCode=as2&amp;tag=abroaview-20&amp;linkId=DNSHYGZA2USRTHCU">Dally and Towles</a>, but it's the kind of thing you could imagine building with that kind of knowledge. It hasn't been long enough since FB published their topology for people to copy them, but is the idea obvious enough that you'd expect it to be independently &quot;copied&quot;?</li> <li>Wait, is that even right? Should we expect a DNS server to sit somewhere in some datacenter?</li> <li>In any case, after all this our DNS resolves query to an IP. We establish a connection, and then what?</li> <li>HTTP GET? How are HTTP 1.0 and 1.1 different? 2.0?</li> <li>And then we get some files back and the browser has to render them somehow. There's a request for the HTML and also for the CSS and js, and separate requests for images? This must be complicated, since browsers are complicated. I don't have any idea of the complexity of this, so there must be a lot I'm missing.</li> <li>After the browser renders something, how does it get to the GPU and what does the GPU do?</li> <li>For 2d graphics, we probably just notify the OS of... something. How does that work?</li> <li>And how does the OS talk to the GPU? Is there some memory mapped region where you can just paint pixels, or is it more complicated than that?</li> <li>How does an LCD display work? How does the connection between the monitor and the GPU work?</li> <li>VGA is probably the simplest possibility. How does that work?</li> <li>If it's a static site, I guess we're done?</li> <li>But if the site has ads, isn't that stuff pretty complicated? How do targeted ads and ad auctions work? A bunch of stuff somehow happens in maybe 200ms?</li> </ol> <p>Where I can get answers to this stuff<sup class=footnote-ref id=fnref:E><a rel=footnote href=#fn:E>1</a></sup>? That's not a rhetorical question! <a href=https://twitter.com/danluu>I'm really interested in hearing about other resources</a>!</p> <p><a href=https://github.com/alex/what-happens-when>Alex Gaynor set up a GitHub repo that attempts to answer this entire question</a>. It answers some of the questions, and has answers to some questions it didn't even occur to me to ask, but it's missing answers to the vast majority of these questions.</p> <p>For high-level answers, here's <a href=http://www.html5rocks.com/en/tutorials/internals/howbrowserswork/ >Tali Garsiel and Paul Irish on how a browser works</a> and <a href=http://pyvideo.org/video/1677/how-the-internet-works>Jessica McKellar how the Internet Works</a>. For how a simple OS does things, <a href=http://pdos.csail.mit.edu/6.828/2014/xv6.html>Xv6</a> has good explanations. For how Linux works, <a href=http://duartes.org/gustavo/blog/ >Gustavo Duarte has a series of explanations here</a><a href=http://www.linusakesson.net/programming/tty/index.php>For TTYs, this article by Linus Akesson is a nice supplement</a> to Duarte's blog.</p> <p>One level down from that, <a href=http://www.jmarshall.com/easy/http/ >James Marshall has a concise explanation of HTTP 1.0 and 1.1</a>, and <a href=http://www.sans.org/reading-room/whitepapers/protocols/ssl-tls-beginners-guide-1029>SANS has an old but readable guide on SSL and TLS</a>. <a href=https://url.spec.whatwg.org/ >This isn't exactly smooth prose, but this spec for URLs explains in great detail what a URL is</a>.</p> <p>Going down another level, <a href=https://technet.microsoft.com/en-us/library/cc786128.aspx>MS TechNet has an explanation of TCP</a>, which also includes a short explanation of UDP.</p> <p>One more level down, <a href=http://www.informit.com/articles/printerfriendly/21320>Kyle Cassidy has a quick primer on Ethernet</a>, <a href=http://arstechnica.com/gadgets/2011/07/ethernet-how-does-it-work/ >Iljitsch van Beijnum has a lengthier explanation with more history</a>, and <a href=http://www.ciscopress.com/articles/printerfriendly/357103>Matthew J Castelli has an explanation of LAN switches</a>. And then we have <a href=http://support.usr.com/support/6000/6000-ug/two.html>DOCSIS and cable modems</a>. <a href=http://www.olson-technology.com/AppNotes/long-haul-communications-systems.pdf>This gives a quick sketch of how long haul fiber is set up</a>, but there must be a better explanation out there somewhere. And here's <a href=//danluu.com/new-cpu-features/ >a quick sketch of modern CPUs</a>. <a href=http://www.waitingforfriday.com/index.php/C64_VICE_Front-End>For an answer to the keyboard specific questions, Simon Inns explains keypress decoding and why you can't press an arbitrary combination of keys on a keyboard</a>.</p> <p>Down one more level, <a href=http://electriciantraining.tpub.com/14182/ >this explains how wires work</a>, <a href=https://www.nanog.org/meetings/nanog57/presentations/Monday/mon.tutorial.Steenbergen.Optical.39.pdf>Richard A. Steenbergen explains fiber</a>, and <a href="http://www.amazon.com/gp/product/0201543931/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=1789&amp;creative=9325&amp;creativeASIN=0201543931&amp;linkCode=as2&amp;tag=abroaview-20&amp;linkId=MXV5K7IJXWXJD446">Pierret</a> <a href="http://www.amazon.com/gp/product/013061792X/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=1789&amp;creative=9325&amp;creativeASIN=013061792X&amp;linkCode=as2&amp;tag=abroaview-20&amp;linkId=N7YLCANVDPI3M35R">explains</a> transistors.</p> <p>P.S. As an interview question, this is pretty much the antithesis of the <a href=http://sockpuppet.org/blog/2015/03/06/the-hiring-post/ >tptacek strategy</a>. From what I've seen, my guess is that tptacek-style interviews are much better filters than open ended questions like this.</p> <p></p> <p>Thanks to Marek Majkowski, Allison Kaptur, Mindy Preston, Julia Evans, Marie Clemessy, and Gordon P. Hemsley for providing answers and links to resources with answers! Also, thanks to Julia Evans and Sumana Harihareswara for convincing me to turn these questions into a blog post.</p>  <div class=footnotes> <hr> <ol> <li id=fn:E>I mostly don't have questions about stuff that happens inside a PC listed, but I'm pretty curious about how modern high-speed busses work and how high-speed chips deal with the massive inductance they must have to deal with getting signals to and from the chip. <a class=footnote-return href=#fnref:E><sup>[return]</sup></a></li> </ol> </div> </main><nav><div class=np> <a href=testing/ >← Given that devs spend the effort they do on testing, what can we do to improve testing?</a> <a href=percentile-latency/ >Goodhearting IQ, cholesterol, and tail latency →</a> </div> <div class=np> <a href= >Archive</a> <a href=https://www.patreon.com/danluu>Patreon</a> <a href=https://mastodon.social/@danluu>Mastodon</a> <a href=https://threads.net/@danluu.danluu>Threads</a> <a href=https://www.linkedin.com/in/danluu/ >LinkedIn</a> <a href=https://twitter.com/danluu/ >Twitter</a> </div></nav>