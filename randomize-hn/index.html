<!doctypehtml><html lang=en><meta charset=utf-8><title>Randomize HN</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="stylesheet" href="/styles.css"></style><link rel=icon href="data:;base64,="> <header><strong>Randomize HN</strong> | <i><b><a href=https://patreon.com/danluu>I'm trying some experimental tiers on Patreon</a></b> to see if I can get to <a href=https://twitter.com/danluu/status/1456346963691991041>substack-like levels of financial support for this blog without moving to substack</a>!</i><hr></header><main> <p>You ever notice that there's this funny threshold for getting to the front page on sites like HN? The exact threshold varies depending on how much traffic there is, but, for articles that aren't wildly popular, there's this moment when the article is at N-1 votes. There is, perhaps, a 60% chance that the vote will come and the article will get pushed to the front page, where it will receive a slew of votes. There is, maybe, a 40% chance it will never get the vote that pushes it to the front page, causing it to languish in obscurity forever.</p> <p>It's non-optimal that an article that will receive 50 votes <a href=https://www.khanacademy.org/math/probability/random-variables-topic/random_variables_prob_dist/v/expected-value--e-x>in expectation</a> has a 60% chance of getting 100+ votes, and a 40% chance of getting 2 votes. Ideally, each article would always get its expected number of votes and stay on the front page for the expected number of time, giving readers exposure to the article in proportion to its popularity. Instead, by random happenstance, plenty of interesting content never makes it the front page, and as a result, the content that does make it gets a higher than optimal level of exposure.</p>  <p>You also see the same problem, with the sign bit flipped, on low traffic sites that push things to the front page the moment they're posted, like <a href=https://lobste.rs/ >lobste.rs</a> and <a href=http://www.reddit.com/r/programming/ >the smaller sub-reddits</a>: they displace links that most people would be interested in by putting links that almost no one cares about on the front page just so that the few things people do care about get enough exposure to be upvoted. On reddit, users &quot;fix&quot; this problem by heavily downvoting most submissions, pushing them off the front page, resulting in a problem that's fundamentally the same as the problem HN has.</p> <p>Instead of implementing some simple and easy to optimize, sites pile on ad hoc rules. Reddit <a href="https://news.ycombinator.com/item?id=6499144">implemented the rising page</a>, but it fails to solve the problem. On low-traffic subreddits, like <a href=http://www.reddit.com/r/programming/rising>r/programming</a> the threshold is so high that it's almost always empty. On high-traffic sub-reddits, anything that's upvoted enough to make it to the rising page is already wildly successful, and whether or not an article becomes successful is heavily dependent on whether or not the first couple voters happen to be people who upvote the post instead of downvoting it, i.e., the problem of getting onto the rising page is no different than the problem of getting to the top normally.</p> <p>HN tries to solve the problem by manually penalizing certain domains and keywords. That doesn't solve the problem for the 95% of posts that aren't penalized. For posts that don't make it to the front page, the obvious workaround is to <a href="https://news.ycombinator.com/item?id=6861735">delete and re-submit your post if it doesn't make the front page the first time around</a>, but that's now <a href="https://news.ycombinator.com/item?id=6861740">a ban worthy offense</a>. Of course, people are working around that, and HN has a workaround for the workaround, and so on. It's endless. That's the problem with &quot;simple&quot; ad hoc solutions.</p> <p>There's an easy fix, but it's counter-intuitive. By adding a small amount of random noise to the rank of an article, we can smooth out the discontinuity between making it onto the front page and languishing in obscurity. The math is simple, but the intuition is even simpler<sup class=footnote-ref id=fnref:A><a rel=footnote href=#fn:A>1</a></sup>. Imagine a vastly oversimplified model where, for each article, every reader upvotes with a fixed probability and the front page gets many more eyeballs than the new page. The result follows. If you like, you can work through the exercise with a more realistic model, but the result is the same<sup class=footnote-ref id=fnref:1><a rel=footnote href=#fn:1>2</a></sup>.</p> <p>Adding noise to smooth out a discontinuity is a common trick when you can settle for an approximate result. I recently employed it to work around the classic floating point problem, where adding a tiny number to a large number results in no change, which is problem when adding many small numbers to some large numbers<sup class=footnote-ref id=fnref:2><a rel=footnote href=#fn:2>3</a></sup>. For a simple example of applying this, consider keeping a reduced precision counter that uses <code>loglog(n)</code> bits to store the value. Let <code>countVal(x) = 2^x</code> and <code>inc(x) = if (rand(2^x) == 0) x++</code><sup class=footnote-ref id=fnref:3><a rel=footnote href=#fn:3>4</a></sup>. Like understanding when to apply Taylor series, this is a simple trick that people are often impressed by if they haven't seen it before<sup class=footnote-ref id=fnref:4><a rel=footnote href=#fn:4>5</a></sup>.</p> <p><strong>Update</strong>: HN tried this! Dan Gackle tells me that it didn't work very well (it resulted in a lot of low quality junk briefly hitting the front page and then disappearing. I think that might be fixable by tweaking some parameters, but the solution that HN settled on, having a human (or multiple humans) put submissions that are deemed to be good or interesting into a &quot;second chance queue&quot; that boosts the submission onto the front page, works better than an a simple randomized algorithm with no direct human input could with any amount of parameter tweaking. I think this is also true of moderation, where the &quot;new&quot; dang/sctb moderation regime has resulted in a marked increase in comment quality, probably better than anything that could be done with an automated ML-based solution today — Google and FB have some of the most advanced automated systems in the world, and the quality of the result is much worse than what we see on HN.</p> <p>Also, at the time this post was written (2013), the threshold to get onto the front page was often 2-3 votes, making the marginal impact of a random passerby who happens to like a submission checking the new page very large. Even during off peak times now (in 2019), the threshold seems to be much higher, reducing the amount of randomness. Additionally, the rise in the popularity of HN increased the sheer volume of low quality content that languishes on the new page, which would reduce the exposure that any particular &quot;good&quot; submisison would get if it were among the 30 items on the new page that would randomly get boosted onto the front page. That doesn't mean there aren't still problems with the current system: most people seem to upvote and comment based on the title of the article and not the content (to check this, read the comments of articles that are mistitled before someone calls this out for a partiular post — it's generally quite clear that most commenters haven't even skimmed the article, let alone read it), but that's a topic for a different post.</p> <div class=footnotes> <hr> <ol> <li id=fn:A>Another way to look at it is that it's A/B testing for upvotes (though, to be pedantic it's actually closer to multi-armed bandit). Another is that the distribution of people reading the front page and the new page aren't the same, and randomizing the front page prevents the clique that reads the new page from having undue influence. <a class=footnote-return href=#fnref:A><sup>[return]</sup></a></li> <li id=fn:1>If you want to do the exercise yourself, pg once said the formula for HN is: (votes - 1) / (time + 2)^1.5. It's possible the power of the denominator has been tweaked, but as long as it's greater than 1.0, you'll a reasonable result. <a class=footnote-return href=#fnref:1><sup>[return]</sup></a></li> <li id=fn:2><a href=http://en.wikipedia.org/wiki/Kahan_summation_algorithm>Kahan summation</a> wasn't sufficient, for the fundamental same reason it won't work for the simplified example I gave above. <a class=footnote-return href=#fnref:2><sup>[return]</sup></a></li> <li id=fn:3>Assume we use a rand function that returns a non-negative integer between 0 and n-1, inclusive. With x = 0, we start counting from 1, <a href=http://julialang.org/ >as God intended</a>. inc(0) will definitely increment, so we'll increment and correctly count to countVal(1) = 2^1 = 2. Next, we'll increment with probability ½; we'll have to increment twice in expectation to increase x. That works out perfectly because countVal(2) = 2^2 = 4, so we want to increment twice before increasing x. Then we'll increment with probability ¼, and so on and so forth. <a class=footnote-return href=#fnref:3><sup>[return]</sup></a></li> <li id=fn:4>See <a href="http://www.amazon.com/gp/product/0521835402/ref=as_li_tf_tl?ie=UTF8&amp;camp=1789&amp;creative=9325&amp;creativeASIN=0521835402&amp;linkCode=as2&amp;tag=abroaview-20">Mitzenmacher</a> for a good introduction to randomized algorithms that also has an explanation of all the math you need to know. If you already apply Chernoff bounds in your sleep, and want something more in-depth, <a href="http://www.amazon.com/gp/product/0521474655/ref=as_li_tf_tl?ie=UTF8&amp;camp=1789&amp;creative=9325&amp;creativeASIN=0521474655&amp;linkCode=as2&amp;tag=abroaview-20">Motwani &amp; Raghavan</a> is awesome. <a class=footnote-return href=#fnref:4><sup>[return]</sup></a></li> </ol> </div> </main><nav><div class=np> <a href=discourage-oss/ >← How to discourage open source contributions</a> <a href=pl-troll/ >Writing safe Verilog →</a> </div> <div class=np> <a href= >Archive</a> <a href=https://www.patreon.com/danluu>Patreon</a> <a href=https://mastodon.social/@danluu>Mastodon</a> <a href=https://threads.net/@danluu.danluu>Threads</a> <a href=https://www.linkedin.com/in/danluu/ >LinkedIn</a> </div></nav>